<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tibia Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Supabase JS v2 (necesario para app.js) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    canvas { display:block; }
    .table-cols-gap { border-collapse: separate; border-spacing: 14px 0; }
  </style>
</head>
<body class="bg-slate-950 text-slate-100">
  <div class="max-w-7xl mx-auto p-4 space-y-6">

    <!-- Filtros -->
    <div class="flex flex-wrap gap-2 items-center">
      <select id="playerSelect" class="bg-slate-900 p-2 rounded"></select>
      <select id="vocationSelect" class="bg-slate-900 p-2 rounded"></select>
      <input id="startDate" type="date" class="bg-slate-900 p-2 rounded" />
      <input id="endDate" type="date" class="bg-slate-900 p-2 rounded" />
      <button id="resetBtn" class="bg-slate-200 text-slate-900 px-3 py-1 rounded">Limpiar filtros</button>
      <div id="status" class="ml-2 text-sm text-slate-400"></div>
    </div>

    <!-- KPIs -->
    <div id="kpis" class="grid md:grid-cols-4 gap-4">
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <div class="text-slate-400 text-sm">Jugadores activos</div>
        <div id="kpiPlayers" class="text-3xl font-semibold">-</div>
      </div>

      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <div class="text-slate-400 text-sm">Avg gain (7d / 30d)</div>
        <div class="text-3xl font-semibold">
          <span id="kpiAvgGain7">-</span> / <span id="kpiAvgGain30">-</span>
        </div>
      </div>

      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <div class="text-slate-400 text-sm">Muertes 칰ltimos 30d</div>
        <div id="kpiDeaths30" class="text-3xl font-semibold">-</div>
      </div>

      <div id="kpiNoAccCard"
           class="rounded-2xl p-4 shadow border border-slate-800 bg-slate-900 transition-colors duration-300">
        <div class="flex items-center gap-2 text-slate-300 text-sm">
          <span id="kpiNoAccIcon" class="text-lg leading-none">游뿠</span>
          <span>D칤as sin accidentes (equipo)</span>
        </div>
        <div id="kpiDaysNoAcc" class="text-3xl font-semibold mt-1">-</div>
        <div id="kpiLastDeathGlobal" class="text-slate-400 text-sm"></div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="flex gap-4 border-b border-slate-800">
      <a href="#" id="tabOverview" class="py-2 px-1 border-b-2 border-transparent hover:border-slate-400">Overview</a>
      <a href="#" id="tabPlayers" class="py-2 px-1 border-b-2 border-transparent hover:border-slate-400">Players</a>
      <a href="#" id="tabDeaths" class="py-2 px-1 border-b-2 border-transparent hover:border-slate-400">Deaths</a>
      <a href="#" id="tabLeaders" class="py-2 px-1 border-b-2 border-transparent hover:border-slate-400">Leaders</a>
    </div>

    <!-- Views -->
    <section id="viewOverview" class="space-y-6">
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Historial de Level (por jugador)</h2>
        <div class="h-80"><canvas id="levelLineChart" class="w-full h-full"></canvas></div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Ganancia diaria (por jugador)</h2>
        <div class="h-80"><canvas id="gainLineChart" class="w-full h-full"></canvas></div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Ganancia por vocaci칩n (7d)</h2>
        <div class="h-80"><canvas id="barGainByVoc" class="w-full h-full"></canvas></div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Muertes por mes</h2>
        <div class="h-80"><canvas id="barDeathsMonthly" class="w-full h-full"></canvas></div>
      </div>
    </section>

    <section id="viewPlayers" class="space-y-6 hidden">
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">칔ltimos snapshots</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm border-collapse">
            <thead class="text-slate-400">
              <tr>
                <th class="text-left py-2 px-2">Jugador</th>
                <th class="text-left py-2 px-2">Vocaci칩n</th>
                <th class="text-right py-2 px-2">Level</th>
                <th class="text-right py-2 px-2">Ganancia 7d</th>
                <th class="text-right py-2 px-2">Fecha</th>
              </tr>
            </thead>
            <tbody id="snapTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="viewDeaths" class="space-y-6 hidden">
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Deaths recientes</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm table-cols-gap">
            <thead class="text-slate-400">
              <tr>
                <th class="text-left py-2 px-2">Jugador</th>
                <th class="text-left py-2 px-2">Fecha</th>
                <th class="text-right py-2 px-2">Level</th>
                <th class="text-left py-2 px-2">Raz칩n</th>
                <th class="text-left py-2 px-2">Killers</th>
                <th class="text-left py-2 px-2">Assists</th>
                <th class="text-right py-2 px-2">D칤as</th>
              </tr>
            </thead>
            <tbody id="deathTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="viewLeaders" class="space-y-6 hidden">
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Leaderboard (7d)</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm border-collapse">
            <thead class="text-slate-400">
              <tr><th class="text-left py-2 px-2">Jugador</th><th class="text-right py-2 px-2">Gain</th></tr>
            </thead>
            <tbody id="lb7"></tbody>
          </table>
        </div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">Leaderboard (30d)</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm border-collapse">
            <thead class="text-slate-400">
              <tr><th class="text-left py-2 px-2">Jugador</th><th class="text-right py-2 px-2">Gain</th></tr>
            </thead>
            <tbody id="lb30"></tbody>
          </table>
        </div>
      </div>
      <div class="bg-slate-900 rounded-2xl p-4 shadow">
        <h2 class="mb-2 font-semibold">M치s muertes (30d)</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm border-collapse">
            <thead class="text-slate-400">
              <tr><th class="text-left py-2 px-2">Jugador</th><th class="text-right py-2 px-2">Deaths</th></tr>
            </thead>
            <tbody id="lbDeaths"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
